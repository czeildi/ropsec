<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sign commits (GPG) • ropsec</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Sign commits (GPG)">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ropsec</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/sign-commits.html">Sign commits (GPG)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropenscilabs/ropsec">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Sign commits (GPG)</h1>
                        <h4 class="author">Ildiko Czeller</h4>
            
            <h4 class="date">2019-05-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropenscilabs/ropsec/blob/master/vignettes/sign-commits.Rmd"><code>vignettes/sign-commits.Rmd</code></a></small>
      <div class="hidden name"><code>sign-commits.Rmd</code></div>

    </div>

    
    
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h1>
<p>It is good practice to sign your commits so that your commits can be verified as certainly made by you and not by someone impersonating you.</p>
<p><img src="../man/figures/signed_commit.png" align="center"></p>
<p>One technology to enable this is <a href="https://gnupg.org/">GPG</a>, which has an <a href="https://github.com/jeroen/gpg">R wrapper</a> written by <a href="https://github.com/jeroen">Jeroen Ooms</a>. The current package provides helper functions and aims to ease the process as much as possible.</p>
<p>Having verified commits has two components:</p>
<ul>
<li>
<a href="#sign_commits">sign your commits</a> (with private key),</li>
<li>
<a href="#upload_key">upload your public key</a> to GitHub, Gitlab, etc so that they can verify your commits (with public key).</li>
</ul>
<p>If you are interested in the background, <a href="https://cran.r-project.org/web/packages/gpg/vignettes/intro.html">general info on GPG</a> is highly recommended.</p>
<p>During the process of creating a private key you will have the option to add password protection. It is strongly recommended to do so otherwise someone having access to your computer will immediately have access to your private key as well. (<a href="https://www.gnupg.org/gph/en/manual/c481.html">Reference</a>.)</p>
</div>
<div id="how-to-sign-commits" class="section level1">
<h1 class="hasAnchor">
<a href="#how-to-sign-commits" class="anchor"></a>How to sign commits</h1>
<ol style="list-style-type: decimal">
<li>Install system dependencies (<a href="https://github.com/jeroen/gpg#installation">GPG Installation instructions</a>)
<ul>
<li>OSX: <code>brew install gnupg</code> (check if installed with <code>gpg --version</code>)
<ul>
<li>for password management from Rstudio</li>
<li><code>brew install pinentry-mac</code></li>
<li><code>echo "pinentry-program /usr/local/bin/pinentry-mac" &gt;&gt; ~/.gnupg/gpg-agent.conf</code></li>
<li>
<code>gpgconf --kill gpg-agent</code> to make sure it will reload configuration</li>
</ul>
</li>
<li>Linux (Debian/Ubuntu):</li>
<li>
<code>apt install gnupg</code> (check if installed with <code>gpg --version</code>)</li>
<li>
<code>apt install libgpgme-dev</code> (to be able to install <code>gpg</code> R package which is a dependency of <code>ropsec</code>)</li>
</ul>
</li>
<li>install ropsec: <code><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">devtools::install_github("ropenscilabs/ropsec")</a></code>
</li>
<li>generate private - public keypair and set it to sign commits
<ul>
<li><a href="#single">one email used with git</a></li>
<li><a href="#multiple">multiple emails used with git</a></li>
</ul>
</li>
<li><a href="#upload_key">upload public key to GitHub/Gitlab/etc</a></li>
</ol>
</div>
<div id="sign_commits" class="section level1">
<h1 class="hasAnchor">
<a href="#sign_commits" class="anchor"></a>Sign commits</h1>
<div id="single" class="section level2">
<h2 class="hasAnchor">
<a href="#single" class="anchor"></a>Single email address, first-time usage</h2>
<p>Run the following command once in any working directory to generate a new key and set it to sign all future commits in all repositories. The email address must be identical to the one you use with the corresponding repository management service (i.e. GitHub, etc).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_key &lt;-<span class="st"> </span><span class="kw">sign_commits_with_key</span>(
  <span class="dt">name =</span> <span class="st">"John Doe"</span>, <span class="dt">email =</span> <span class="st">"johndoe@example.com"</span>
)</code></pre></div>
<pre><code>#&gt; `John Doe` (as provided) and
#&gt; `johndoe@example.com` (as provided)
#&gt; will be used to generate a new gpg key.
#&gt; Please enter password for new gpg key: ********
#&gt; Do you want to sign all future commits with `ABCDEFGHIJKLMNOP` in all repositories?
#&gt; 
#&gt; 1: Yes
#&gt; 2: Not now
#&gt; 3: Absolutely not
#&gt; Selection: 1</code></pre>
<p>Next step: <a href="#upload_key">upload your public key</a> to GitHub/Gitlab/etc.</p>
</div>
<div id="multiple" class="section level2">
<h2 class="hasAnchor">
<a href="#multiple" class="anchor"></a>Multiple email addresses, first-time usage</h2>
<p>One common use-case is to have a personal and a work email or two different work emails as well and you use git with both of them. At the first time you want to use them, generate a key and set to use it in the repository. The email addresses must be identical to the ones you use with the corresponding repository management service(s) (i.e. GitHub, etc).</p>
<p>Run the following in a personal (aka email address 1) git repository:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_key &lt;-<span class="st"> </span><span class="kw">sign_commits_with_key</span>(
  <span class="dt">name =</span> <span class="st">"John Doe"</span>, <span class="dt">email =</span> <span class="st">"jd@personal.com"</span>, <span class="dt">global =</span> <span class="ot">FALSE</span>
)</code></pre></div>
<p>Next step: <a href="#upload_key">upload your public key</a> to GitHub/Gitlab/etc.</p>
<p>In a work-related git repository:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_key &lt;-<span class="st"> </span><span class="kw">sign_commits_with_key</span>(
  <span class="dt">name =</span> <span class="st">"John Doe"</span>, <span class="dt">email =</span> <span class="st">"jd@company.com"</span>, <span class="dt">global =</span> <span class="ot">FALSE</span>
)</code></pre></div>
<p>Next step: <a href="#upload_key">upload your public key</a> to GitHub/Gitlab/etc.</p>
</div>
<div id="multiple-email-addresses-existing-key" class="section level2">
<h2 class="hasAnchor">
<a href="#multiple-email-addresses-existing-key" class="anchor"></a>Multiple email addresses, existing key</h2>
<p>Later, for convenience the appropriate key can be identified based on email as well or if the local git config is set you can even rely on that.</p>
<p>In another work-related repository:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sign_commits_with_key</span>(<span class="dt">email =</span> <span class="st">"jd@company.com"</span>, <span class="dt">global =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>In yet another work-related repository:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="fu">git</span> config user.email jd@company.com</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sign_commits_with_key</span>(<span class="dt">global =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>#&gt; Existing key found: 1234561234561234.
#&gt; Corresponding email: jd@company.com (based on local git config).
#&gt; 
#&gt; Do you want to sign all future commits with `1234561234561234` in this repository?
#&gt; 
#&gt; 1: Yes
#&gt; 2: Absolutely not
#&gt; 3: Not now
#&gt; 
#&gt; Selection: 1
#&gt; [1] "1234561234561234"</code></pre>
<p>You may choose to set one of them globally which thus will be the default key to use in a repository where the repository level configs are not set to a different value.</p>
</div>
<div id="single-email-address-existing-key" class="section level2">
<h2 class="hasAnchor">
<a href="#single-email-address-existing-key" class="anchor"></a>Single email address, existing key</h2>
<p>(possibly generated with <code>gpg --full-generate-key</code> or with this package previously)</p>
<div id="provide-key-id" class="section level3">
<h3 class="hasAnchor">
<a href="#provide-key-id" class="anchor"></a>provide key id</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sign_commits_with_key</span>(<span class="dt">key =</span> <span class="st">"ABCDEFGHIJKLMNOP"</span>)</code></pre></div>
</div>
<div id="find-based-on-user-name-andor-email" class="section level3">
<h3 class="hasAnchor">
<a href="#find-based-on-user-name-andor-email" class="anchor"></a>find based on user name and/or email</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sign_commits_with_key</span>(<span class="dt">name =</span> <span class="st">"John Doe"</span>)</code></pre></div>
<pre><code>#&gt; Existing key found: ABCDEFGHIJKLMNOP.
#&gt; Corresponding email: johndoe@example.com (based on local git config).
#&gt; 
#&gt; Do you want to sign all future commits with `ABCDEFGHIJKLMNOP` in all repositories?
#&gt; ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sign_commits_with_key</span>(<span class="dt">email =</span> <span class="st">"johndoe@example.com"</span>)</code></pre></div>
</div>
</div>
</div>
<div id="upload_key" class="section level1">
<h1 class="hasAnchor">
<a href="#upload_key" class="anchor"></a>Upload your public key to repository management services</h1>
<p>To generate a new key or find an existing one, use <a href="#sign_commits"><code>sign_commits_with_key</code></a>. In the following <code>new_key</code> refers to the id of the key you want to upload that you can get as the return value of <a href="#sign_commits"><code>sign_commits_with_key</code></a>.</p>
<p>To upload to GitHub without leaving your R session you need the following:</p>
<ul>
<li>a personal access token with at least <code>write:gpg_key</code> scope enabled. You can grant access to tokens <a href="https://github.com/settings/tokens">here</a>.</li>
<li>supply your token manually or store it in <code>GITHUB_PAT</code> env var</li>
<li>
<code>store_public_key(key = new_key, service = "gh")</code> or <code>store_public_key(key = new_key, service = "gh", .token = token)</code>
</li>
</ul>
<p>To upload to Gitlab without leaving your R session you need the following:</p>
<ul>
<li>a personal access token with at least <code>api</code> scope enabled.</li>
<li><code>store_public_key(key = new_key, service = "gl", gitlab_url = "https://gitlab.example.com")</code></li>
</ul>
<p>You can use any service (GitHub, Gitlab etc) which supports GPG by manually adding your <strong>public</strong> GPG key which you can get by</p>
<ul>
<li>
<code>store_public_key(key = new_key)</code> or</li>
<li><code><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat(gpg::gpg_export(key = new_key))</a></code></li>
</ul>
</div>
<div id="troubleshooting" class="section level1">
<h1 class="hasAnchor">
<a href="#troubleshooting" class="anchor"></a>Troubleshooting</h1>
<div id="turn-it-off" class="section level2">
<h2 class="hasAnchor">
<a href="#turn-it-off" class="anchor"></a>Turn it off</h2>
<p>If you do not want to sign commits or there is some issue and you cannot even commit, the easiest solution is setting <code>commit.gpgsign</code> in the git config to <code>false</code>. You can do it by running one of the following commands in your terminal:</p>
<ul>
<li>in specific repository: <code>git config commit.gpgsign false</code>
</li>
<li>globally: <code>git config --global commit.gpgsign false</code>
</li>
</ul>
</div>
<div id="check" class="section level2">
<h2 class="hasAnchor">
<a href="#check" class="anchor"></a>Check</h2>
<ul>
<li>
<code>git verify-commit HEAD</code> or <code>git log --show-signature</code>
</li>
<li>signing plaintext: <code>echo "test" | gpg --clearsign</code>
</li>
<li>commit from command line and not Rstudio or another GUI</li>
</ul>
</div>
<div id="attempt-to-fix" class="section level2">
<h2 class="hasAnchor">
<a href="#attempt-to-fix" class="anchor"></a>Attempt to fix</h2>
<ul>
<li>check that <code>git config gpg.program</code> matches your installed version</li>
<li>set env var: <code>GPG_TTY=$(tty)</code> (with <code>echo "export GPG_TTY=$(tty)" &gt;&gt; ~/.bashrc</code> or similar), then <code>gpgconf --kill gpg-agent</code> to make sure it will reload configuration</li>
<li>
<code>echo 'no-tty' &gt;&gt; ~/.gnupg/gpg.conf</code>, then <code>gpgconf --kill gpg-agent</code> to make sure it will reload configuration</li>
</ul>
</div>
</div>
<div id="further-details" class="section level1">
<h1 class="hasAnchor">
<a href="#further-details" class="anchor"></a>Further details</h1>
<p>If you use other gpg program, for example gnupg2 on Linux, you have to run the following first:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="fu">git</span> config --global gpg.program gpg2</code></pre></div>
<p>In addition to generating a GPG keys, the following git config elements are manipulated:</p>
<ul>
<li><code>gpg.program</code></li>
<li><code>commit.gpgsign</code></li>
<li><code>user.email</code></li>
<li>
<code>user.name</code> (read-only)</li>
<li><code>user.signingkey</code></li>
</ul>
<div id="password-remembering" class="section level2">
<h2 class="hasAnchor">
<a href="#password-remembering" class="anchor"></a>Password remembering</h2>
<ul>
<li>keychain: if you opt for this option, keychain can remember your password forever.</li>
<li>gpg agent: remembers password until the process is alive or password cache ttl expires. (Relevant options: -max-cache-ttl (2 hours by default) and –default-cache-ttl (10 minutes by default). <a href="https://www.gnupg.org/documentation/manuals/gnupg/Agent-Options.html">Reference</a>.)</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#background">Background</a></li>
      <li><a href="#how-to-sign-commits">How to sign commits</a></li>
      <li>
<a href="#sign_commits">Sign commits</a><ul class="nav nav-pills nav-stacked">
<li><a href="#single">Single email address, first-time usage</a></li>
      <li><a href="#multiple">Multiple email addresses, first-time usage</a></li>
      <li><a href="#multiple-email-addresses-existing-key">Multiple email addresses, existing key</a></li>
      <li><a href="#single-email-address-existing-key">Single email address, existing key</a></li>
      </ul>
</li>
      <li><a href="#upload_key">Upload your public key to repository management services</a></li>
      <li>
<a href="#troubleshooting">Troubleshooting</a><ul class="nav nav-pills nav-stacked">
<li><a href="#turn-it-off">Turn it off</a></li>
      <li><a href="#check">Check</a></li>
      <li><a href="#attempt-to-fix">Attempt to fix</a></li>
      </ul>
</li>
      <li>
<a href="#further-details">Further details</a><ul class="nav nav-pills nav-stacked">
<li><a href="#password-remembering">Password remembering</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Ildiko Czeller, Karthik Ram, Kara Woo, Bob Rudis.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
